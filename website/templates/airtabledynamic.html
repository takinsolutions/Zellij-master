{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}AirTable Generated Document{% endblock %}</h1>
{% endblock %}

{% block content %}
<style>
  .errormessage p.error { color: #F00; }
  .errormessage pre { font-size: 9pt; line-height: normal; margin: 0; padding: 0; }
  .errormessage pre .linenumber { color: #CCC; }
  .errormessage pre .errorline { color: #F90; }
  .errormessage pre .error { color: #F00; }
</style>
{# create TOC #}
    <table class="visible">
      <tr><th>#</th><th>Name</th><th>Function / Description</th></tr>
{% for agg in dataobj.values() %}
      <tr><td>{{agg["Identifier"]}}</td><td>{% if agg.BaseData %}<a href="#{{agg["Name"]}}">{% endif %}{{agg["Name"]}}{% if agg["Fields"] %}</a>{% endif %}</td><td>{{agg["Description"]}}</td></tr>
{% endfor %}
    </table>

{# create individual Chapters #}
{% for agg in dataobj.values() %}
{% if agg.BaseData %}
    <h3 id="{{agg["Name"]}}">{{agg["Name"]}}</h3>
    <p>{{agg["Description"]}}</p>
    <table class="visible">
      <tr><th>Identifier</th><th>Name</th><th>Description</th><th>CRM Path</th></tr>
{% for fld in agg.BaseData.values() %}
      <tr><td>{{fld["Identifier"]}}</td><td>{{fld["Name"]}}</td><td>{{fld["Description"]}}</td><td>{{fld["CRMPath"]}}</td></tr>
{% endfor %}{# "Fields" loop for sub-tables #}
    </table>
    <p></p>
    <details class="example turtle">
      <summary>Turtle Encoding</summary>
      <div class="highlight"><pre><code>
{{agg.turtle()}}
      </code></pre></div>
    </details>
    <details class="example jsonld">
      <summary>{% if agg.is_jsonld() %}JSON-LD Encoding{% else %}JSON-LD Error{% endif %}</summary>
      <div class="highlight">
{% if agg.is_jsonld() %}
        <pre><code>
{{agg.jsonld()}}
        </code></pre>
{% else %}
        <div class="errormessage">
{{agg.jsonld_error()|safe}}
        </div>
{% endif %}
      </div>
    </details>
{% endif %}{# Do nothing if subtable is empty #}
{% endfor %}{# Master loop over Chapters #}

<p><small>Generated by Zellīj, © 2021.</small></p>
{% endblock %}
